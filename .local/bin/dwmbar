#!/usr/bin/env sh

trap 'update' 5

delim="|"

status() {
    SSID=$(nmcli -t -f active,ssid dev wifi | grep '^yes' | cut -c 5-)
    echo "  $SSID"

    echo $delim

    VOL="$(amixer get Master | tail -n1 | sed -r "s/.*\[(.*)%\].*/\1/")"
    MUTED="$(amixer get Master | tail -n1 | sed -r "s/.*\[(.*)\]$/\1/")"

    if [ "$MUTED" = "off" ]; then
		ICON=""
    else
        ICON=""
    fi
    echo "$ICON $VOL"

    echo $delim

    CHARGE=$(cat /sys/class/power_supply/BAT0/capacity)
    echo " $CHARGE"

    echo $delim

    case "$(xset -q|grep LED| awk '{ print $10 }')" in
      "00000000") KBD="en" ;;
      "00001000") KBD="ru" ;;
      "00000001") KBD="EN" ;;
      "00001001") KBD="RU" ;;
      *) KBD="unknown" ;;
    esac
    echo " $KBD"

	echo $delim

    echo " $(date +"%A, %B %d")"

	echo $delim

    echo "$(date +"%l:%M%p")"
}


update() {
    xsetroot -name "$(status | tr '\n' ' ')" &
    wait
}


while :; do
    update
    sleep 1 &
    wait
done
